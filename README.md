# VR 5.0 TQQQ 리밸런싱 도우미 (격주)

**라오어 변동성 리밸런싱(VR 5.0) 전략**을 활용한 TQQQ 2주 단위 리밸런싱 웹 애플리케이션입니다.

## 🎉 주요 기능 (v2.0)

### ✅ 영구 저장
- 모든 입력값과 로그가 **파일 기반으로 자동 저장**
- 앱 재시작/배포 재시작 후에도 데이터 유지
- `data/vr_state.json`, `data/vr_log.csv`, `data/vr_trades.csv`

### 📊 매수/매도 로그
- **권고표**: 계산할 때마다 자동으로 권고안 저장 (BUY/SELL/HOLD)
- **체결표**: 실제 거래 체결 시 기록 (매수/매도, 수량, 체결가, 메모)
- CSV 다운로드 지원

### 📈 차트 & 프로젝션
- **과거 가격**: TQQQ 3개월/6개월/1년 종가 라인
- **현재 밴드**: V_next, 상단/하단 밴드 수평선
- **미래 프로젝션**: 향후 n사이클(2~12, 기본 6) V 경로와 밴드를 점선으로 표시
- Plotly 인터랙티브 차트

### 🔄 실시간 가격
- 페이지 로드 시 TQQQ 현재가 자동 조회
- 새로고침 버튼으로 즉시 업데이트

### 🧮 VR 5.0 계산
- 밴드 기반 매수/매도/HOLD 판단
- 액션 배지 및 거래 수량/금액 자동 계산
- 2주 후 점검 ICS 일정 파일 다운로드

---

## 🌐 웹앱 배포 (온라인 접속)

### 이미 배포된 앱
👉 **https://vr5-bands-app.streamlit.app** (또는 실제 배포 URL)

### 직접 배포하려면

1. **GitHub에 코드 업로드**
   ```bash
   git clone https://github.com/hyunkyu-cpu/vr5-bands-app.git
   cd vr5-bands-app
   ```

2. **Streamlit Community Cloud 배포**
   - [share.streamlit.io](https://share.streamlit.io)에 접속
   - GitHub 계정으로 로그인
   - "New app" 클릭
   - 저장소: `hyunkyu-cpu/vr5-bands-app`
   - Branch: `main`
   - Main file: `app.py`
   - "Deploy" 클릭

3. **완료!**
   - 2-3분 후 앱 접속 가능
   - 어디서든 웹브라우저로 사용

---

## 💻 로컬 설치 및 실행

### 1. 저장소 클론

```bash
git clone https://github.com/hyunkyu-cpu/vr5-bands-app.git
cd vr5-bands-app
```

### 2. 의존성 설치

```bash
pip install -r requirements.txt
```

### 3. 실행

```bash
streamlit run app.py
```

브라우저에서 자동으로 `http://localhost:8501`이 열립니다.

---

## 📁 프로젝트 구조

```
vr5-bands-app/
├── app.py                      # 메인 애플리케이션
├── utils/
│   ├── vr.py                   # VR 5.0 계산 로직 + 프로젝션
│   └── io.py                   # 영구 저장 + 로그/체결 관리 + ICS
├── pages/
│   └── 02_차트.py               # Plotly 차트 + 프로젝션 페이지
├── data/                       # 자동 생성되는 데이터 폴더
│   ├── vr_state.json           # 마지막 상태 (영구 저장)
│   ├── vr_log.csv              # 권고 로그
│   └── vr_trades.csv           # 체결 기록
├── requirements.txt            # 의존성
├── packages.txt                # 시스템 패키지 (비어있음)
└── README.md                   # 문서
```

---

## 🎯 사용법

### 메인 페이지 (리밸런싱 계산)

1. **입력 정보**
   - 티커: 기본값 `TQQQ`
   - 보유 수량: 현재 보유 주식 수
   - POOL 현금: 보유 현금 (달러)
   - 직전 목표 Value: 이전 리밸런싱 시점의 목표 가치
   - 분모 d: 공격성 조절 (기본값: 11)
   - 밴드폭: 리밸런싱 밴드 (기본값: ±0.15 = ±15%)
   - 2주 적립금: 추가 입금 예정 금액 (거치식은 0)

2. **계산하기** 버튼 클릭

3. **결과 확인**
   - 액션 배지: 🟢 BUY / 🔴 SELL / ⚪ HOLD
   - 현재 평가액, 목표 가치, 밴드 정보
   - 거래 금액 및 수량
   - **자동 저장 완료** 토스트 메시지

4. **체결 등록** (선택)
   - 실제로 거래를 체결했을 때 기록
   - 매수/매도, 수량, 체결가, 메모 입력

5. **로그 확인**
   - 권고 로그: 모든 계산 이력
   - 체결 기록: 실제 거래 이력
   - CSV 다운로드 가능

### 차트 페이지

1. 사이드바에서 "02_차트" 선택
2. 티커 입력 (기본값: TQQQ)
3. 히스토리 기간 선택 (3개월/6개월/1년)
4. 프로젝션 사이클 수 선택 (2~12, 기본: 6)
5. **"📊 차트 생성"** 버튼 클릭
6. 인터랙티브 차트 확인:
   - 파란선: 과거 TQQQ 종가
   - 초록선: V_next (목표 가치)
   - 빨간선: 하단 밴드
   - 주황선: 상단 밴드
   - 점선: 미래 프로젝션 (2주 단위)

---

## 🧮 VR 5.0 계산 공식

1. **현재 평가액**: `PV = price × shares`
2. **상승률**: `r = 1 + (pool / V_prev) / d`
3. **다음 목표 가치**: `V_next = V_prev × r + contrib`
4. **밴드**:
   - 하단: `low = V_next × (1 - band)`
   - 상단: `high = V_next × (1 + band)`
5. **판단**:
   - `PV < low` → **매수** (`ceil((V_next - PV) / price)` 주)
   - `PV > high` → **매도** (`floor((PV - V_next) / price)` 주)
   - 밴드 내 → **HOLD**

---

## 📊 테스트 시나리오

### 기본 테스트

입력:
- 보유 수량: 891
- POOL 현금: $18,000
- 직전 목표 Value: $25,000
- 분모 d: 11
- 밴드폭: 0.15
- 2주 적립금: $250

결과:
- 현재 TQQQ 가격에 따라 BUY/SELL/HOLD 판단
- 영구 저장 확인: 앱 재시작 후에도 입력값 유지
- 로그 테이블에 새로운 레코드 추가

---

## 🔑 주요 파라미터

| 파라미터 | 설명 | 기본값 | 권장 범위 |
|---------|------|--------|----------|
| **d** | 공격성 조절 (높을수록 보수적) | 11 | 8~15 |
| **band** | 리밸런싱 밴드폭 | 0.15 | 0.10~0.20 |
| **contrib** | 격주 적립금 | 0 | 0+ |

---

## ⚠️ 주의사항

1. **네트워크 연결**: yfinance는 인터넷 연결 필요
2. **시장 시간**: 시장 마감 후에는 전일 종가 표시
3. **티커 확인**: 올바른 티커 심볼 입력 (TQQQ, QQQ, SPY 등)
4. **데이터 영구성**: Streamlit Cloud에서는 `data/` 폴더가 배포 시마다 초기화될 수 있음 (로컬 실행 권장)

---

## 🛠 기술 스택

- **프론트엔드**: Streamlit
- **데이터 조회**: yfinance
- **데이터 처리**: pandas
- **차트**: Plotly
- **일정 관리**: ics, pytz
- **영구 저장**: JSON (상태), CSV (로그/체결)

---

## 📝 변경 이력

### v2.0 (최신)
- ✅ 파일 기반 영구 저장 (JSON + CSV)
- ✅ 권고 로그 및 체결 기록 테이블
- ✅ Plotly 차트 + 미래 프로젝션
- ✅ 원자적 파일 쓰기 (데이터 안전성)

### v1.0
- 실시간 TQQQ 가격 조회
- VR 5.0 리밸런싱 계산
- 기본 차트 (6개월 종가)
- ICS 일정 파일

---

## 📄 라이선스

MIT License

---

## 📞 문의

이슈나 개선 제안은 [GitHub Issues](https://github.com/hyunkyu-cpu/vr5-bands-app/issues)를 활용해주세요.

---

**🚀 VR 5.0 TQQQ 리밸런싱 도우미** | 2주마다 스마트한 리밸런싱 | 영구 저장 & 프로젝션 지원
